<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deriv HR Operations Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0b0b0f;--s1:#13131a;--s2:#1a1a24;--s3:#22222e;--bd:#2a2a38;--bd2:#35354a;--tx:#e2e2ef;--dim:#8888a0;--mu:#555568;--red:#ff453a;--or:#ff9f0a;--yl:#ffd60a;--gn:#32d74b;--bl:#0a84ff;--pu:#bf5af2;--cy:#64d2ff;--r:10px}
body{background:var(--bg);color:var(--tx);font-family:'Inter',sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden}

/* NAV */
nav{height:46px;background:var(--s1);border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between;padding:0 16px;flex-shrink:0}
.nav-l{display:flex;align-items:center;gap:8px}
.logo{width:26px;height:26px;background:linear-gradient(135deg,var(--red),#ff6b6b);border-radius:7px;display:grid;place-items:center;font-weight:800;font-size:11px;color:#fff}
nav h1{font-size:13px;font-weight:700;letter-spacing:-.3px}
nav h1 span{color:var(--dim);font-weight:400;font-size:12px}
.st{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:500}
.st .dot{width:7px;height:7px;border-radius:50%;animation:p 2s infinite}
@keyframes p{0%,100%{opacity:1}50%{opacity:.35}}

/* LAYOUT */
.wrap{display:flex;flex:1;overflow:hidden}

/* SIDEBAR */
.sb{width:280px;background:var(--s1);border-right:1px solid var(--bd);display:flex;flex-direction:column;overflow-y:auto;flex-shrink:0}
.sb-sec{padding:12px}
.sb-sec+.sb-sec{border-top:1px solid var(--bd)}
.sb-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--dim);margin-bottom:8px}

/* Phase tabs */
.pt{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:var(--r);cursor:pointer;margin-bottom:2px;font-size:12px;color:var(--dim);transition:.15s}
.pt:hover{background:var(--s2)}
.pt.on{background:var(--s3);color:var(--tx)}
.pt .ic{font-size:15px}

/* Prompt buttons */
.pb{display:block;width:100%;text-align:left;padding:8px 10px;background:var(--s2);border:1px solid var(--bd);border-radius:var(--r);color:var(--tx);font-size:11.5px;cursor:pointer;margin-bottom:4px;transition:.15s;line-height:1.45}
.pb:hover{background:var(--s3);border-color:var(--bd2)}
.pb .tag{display:block;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
.pb .tag.t1{color:var(--bl)}.pb .tag.t2{color:var(--gn)}.pb .tag.t3{color:var(--or)}

/* CHAT */
.chat{flex:1;display:flex;flex-direction:column;overflow:hidden}

/* Messages */
.msgs{flex:1;overflow-y:auto;padding:16px 20px;display:flex;flex-direction:column;gap:8px}
.m{max-width:88%;animation:fu .2s ease}
@keyframes fu{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:none}}
.m.u{align-self:flex-end}
.m.a{align-self:flex-start;width:88%}
.m-from{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px}
.m.u .m-from{color:rgba(255,255,255,.5);text-align:right}
.m.a .m-from{color:var(--dim)}
.m-bub{padding:10px 14px;border-radius:var(--r);font-size:13px;line-height:1.7;white-space:pre-wrap;word-break:break-word}
.m.u .m-bub{background:var(--bl);color:#fff;border-bottom-right-radius:3px}
.m.a .m-bub{background:var(--s2);border:1px solid var(--bd);border-bottom-left-radius:3px}

/* Thinking */
.thk{align-self:flex-start;display:flex;align-items:center;gap:6px;padding:6px 10px;font-size:12px;font-weight:500;color:var(--dim);animation:fu .2s}
.thk .dd span{animation:bl 1.4s infinite;font-size:16px}
.thk .dd span:nth-child(2){animation-delay:.2s}
.thk .dd span:nth-child(3){animation-delay:.4s}
@keyframes bl{0%,80%,100%{opacity:.15}40%{opacity:1}}

/* Input */
.inp{padding:10px 14px;border-top:1px solid var(--bd);background:var(--s1);display:flex;gap:8px;align-items:flex-end;flex-shrink:0}
.inp textarea{flex:1;background:var(--s2);border:1px solid var(--bd);border-radius:var(--r);padding:10px 12px;color:var(--tx);font:400 13px 'Inter';resize:none;outline:none;height:42px;max-height:140px;transition:.15s;line-height:1.5}
.inp textarea:focus{border-color:var(--bl)}
.inp textarea::placeholder{color:var(--mu)}
.snd{background:var(--bl);color:#fff;border:none;border-radius:var(--r);width:42px;height:42px;cursor:pointer;display:grid;place-items:center;font-size:18px;transition:.15s;flex-shrink:0}
.snd:hover{opacity:.85}.snd:disabled{opacity:.25;cursor:not-allowed}
.rst{background:var(--s2);color:var(--dim);border:1px solid var(--bd);border-radius:var(--r);height:42px;padding:0 12px;cursor:pointer;font:600 10px 'Inter';letter-spacing:.5px;text-transform:uppercase;transition:.15s;flex-shrink:0}
.rst:hover{color:var(--tx);border-color:var(--bd2)}

/* Welcome */
.wel{display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;text-align:center;padding:30px}
.wel h2{font-size:24px;font-weight:800;letter-spacing:-.7px;margin-bottom:6px}
.wel h2 em{font-style:normal;background:linear-gradient(135deg,var(--bl),var(--pu));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.wel>p{color:var(--dim);font-size:13.5px;max-width:500px;margin-bottom:24px;line-height:1.6}
.wel-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:620px;width:100%}
.wel-card{background:var(--s2);border:1px solid var(--bd);border-radius:var(--r);padding:16px 14px;cursor:pointer;text-align:left;transition:.2s}
.wel-card:hover{border-color:var(--bd2);background:var(--s3);transform:translateY(-2px)}
.wel-card .wic{font-size:22px;margin-bottom:6px}
.wel-card h3{font-size:12px;font-weight:700;margin-bottom:4px}
.wel-card p{font-size:11px;color:var(--dim);line-height:1.45}

/* Agent response formatting */
.m-bub h1,.m-bub h2,.m-bub h3{font-weight:700;margin-top:10px;margin-bottom:4px}
.m-bub h1{font-size:15px;color:var(--bl)}.m-bub h2{font-size:14px;color:var(--cy)}.m-bub h3{font-size:13px}
.m-bub strong,.m-bub b{color:var(--tx);font-weight:600}
.m-bub code{background:var(--s3);padding:1px 5px;border-radius:3px;font-family:monospace;font-size:12px}
.m-bub hr{border:none;border-top:1px solid var(--bd);margin:10px 0}
.m-bub ul,.m-bub ol{padding-left:18px;margin:4px 0}
.m-bub li{margin:2px 0}
.m-bub table{border-collapse:collapse;margin:8px 0;font-size:12px;width:100%}
.m-bub th,.m-bub td{border:1px solid var(--bd);padding:5px 8px;text-align:left}
.m-bub th{background:var(--s3);font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.3px}

/* Timer */
.timer{position:fixed;bottom:60px;right:20px;background:var(--s2);border:1px solid var(--bd);border-radius:var(--r);padding:6px 12px;font-size:11px;color:var(--dim);display:none;z-index:99}
.timer span{font-weight:700;color:var(--or);font-variant-numeric:tabular-nums}

@media(max-width:860px){.sb{width:220px}}
@media(max-width:640px){.sb{display:none}}
</style>
</head>
<body>

<nav>
 <div class="nav-l"><div class="logo">D</div><h1>HR Operations Platform <span>¬∑ Deriv AI Talent Sprint</span></h1></div>
 <div class="st"><div class="dot" id="dot"></div><span id="stxt">Checking...</span></div>
</nav>

<div class="wrap">

<!-- SIDEBAR -->
<div class="sb">
 <div class="sb-sec">
  <div class="sb-lbl">Phase</div>
  <div class="pt on" data-p="all"><span class="ic">‚ö°</span>All Phases</div>
  <div class="pt" data-p="p3"><span class="ic">üõ°</span>Compliance Intelligence</div>
  <div class="pt" data-p="p1"><span class="ic">üìÑ</span>Document Generation</div>
  <div class="pt" data-p="p2"><span class="ic">üí¨</span>HR Policy Assistant</div>
 </div>
 <div class="sb-sec">
  <div class="sb-lbl">Click to Demo</div>
  <div id="prompts"></div>
 </div>
</div>

<!-- CHAT -->
<div class="chat">
 <div class="msgs" id="msgs">
  <div class="wel" id="wel">
   <h2>HR operations that run <em>themselves</em></h2>
   <p>This is a <b>live agent</b> ‚Äî every response is generated in real-time by Gemini reasoning over Deriv's HR data. Click a card or type below.</p>
   <div class="wel-grid">
    <div class="wel-card" onclick="fire('scan')">
     <div class="wic">üõ°</div>
     <h3>Compliance Scan</h3>
     <p>Agent autonomously scans all 20 employees for visa, cert & equipment risks</p>
    </div>
    <div class="wel-card" onclick="fire('onboard')">
     <div class="wic">üìÑ</div>
     <h3>Generate Onboarding</h3>
     <p>Offer letter + contract + NDA + equity in one command, jurisdiction-aware</p>
    </div>
    <div class="wel-card" onclick="fire('leave')">
     <div class="wic">üí¨</div>
     <h3>Ask Policy Question</h3>
     <p>Instant answer from HR knowledge base ‚Äî leave, expenses, benefits</p>
    </div>
   </div>
  </div>
 </div>
 <div class="inp">
  <textarea id="inp" placeholder="Ask the HR agent anything..." rows="1" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();send()}"></textarea>
  <button class="snd" id="sbtn" onclick="send()">‚Üë</button>
  <button class="rst" onclick="reset()">Reset</button>
 </div>
</div>

</div>

<div class="timer" id="timer">Agent thinking: <span id="tval">0s</span></div>

<script>
const API = location.origin;
const UID = 'u_'+Math.random().toString(36).slice(2,8);
let busy = false, timerInt = null;

// ‚îÄ‚îÄ PROMPTS ‚îÄ‚îÄ
const P = {
 all: [
  {id:'scan',tag:'PHASE 3',cls:'t3',label:'Run autonomous compliance scan',text:'Run your full autonomous compliance scan. Analyze all 20 employees across all jurisdictions. Show me critical issues, your AI reasoning about severity, cross-correlations, and financial exposure.'},
  {id:'onboard',tag:'PHASE 1',cls:'t1',label:'Generate full onboarding (Dubai)',text:'Generate complete onboarding package for Sarah Chen, Senior Engineer, Engineering department, salary AED 480000, currency AED, location Dubai, start date 2026-03-01, level senior'},
  {id:'leave',tag:'PHASE 2',cls:'t2',label:'What is the leave policy?',text:'What is the annual leave policy? How many days do employees get?'},
 ],
 p3: [
  {id:'scan',tag:'PHASE 3',cls:'t3',label:'Full compliance scan (autonomous)',text:'Run your full autonomous compliance scan. Analyze all 20 employees across all jurisdictions. Show me critical issues, your AI reasoning about severity, cross-correlations, and financial exposure.'},
  {id:'predict',tag:'PHASE 3',cls:'t3',label:'Simulate: what happens in 30 days?',text:'Simulate what happens to our compliance risk if we take zero action for the next 30 days. Which items will escalate? What is the projected financial exposure?'},
  {id:'deep',tag:'PHASE 3',cls:'t3',label:'Deep dive: Tom Baker (E110)',text:'Do a complete deep dive on employee E110 ‚Äî Tom Baker. He has multiple compliance issues. Analyze the compounding risk and what we should do.'},
  {id:'org',tag:'PHASE 3',cls:'t3',label:'Organizational risk patterns',text:'Show me the organizational risk data. Which departments and locations have the most compliance issues? Are there systemic patterns vs individual failures?'},
 ],
 p1: [
  {id:'onboard',tag:'PHASE 1',cls:'t1',label:'Full onboarding package (Dubai)',text:'Generate complete onboarding package for Sarah Chen, Senior Engineer, Engineering department, salary AED 480000, currency AED, location Dubai, start date 2026-03-01, level senior'},
  {id:'contract_malta',tag:'PHASE 1',cls:'t1',label:'Employment contract (Malta)',text:'Generate an employment contract for James Wilson, Senior Data Analyst, Finance department, salary EUR 65000, currency EUR, location Malta, start date 2026-04-01'},
  {id:'nda',tag:'PHASE 1',cls:'t1',label:'Generate NDA (Dubai)',text:'Generate a Non-Disclosure Agreement for Priya Sharma, Compliance Officer, location Dubai'},
  {id:'equity',tag:'PHASE 1',cls:'t1',label:'Equity grant letter (Cyberjaya)',text:'Generate an equity grant letter for David Kim, Staff Engineer, Engineering department, level lead, location Cyberjaya'},
  {id:'offer',tag:'PHASE 1',cls:'t1',label:'Offer letter (Malaysia)',text:'Generate an offer letter for Mei Lin Tan, Senior QA Engineer, Engineering department, salary MYR 180000, currency MYR, location Cyberjaya, start date 2026-05-15'},
 ],
 p2: [
  {id:'leave',tag:'PHASE 2',cls:'t2',label:'Annual leave policy',text:'What is the annual leave policy? How many days do employees get? Are there differences by jurisdiction?'},
  {id:'expense',tag:'PHASE 2',cls:'t2',label:'Can I expense coworking space?',text:'Can I expense a coworking space? What are the limits and process?'},
  {id:'maternity',tag:'PHASE 2',cls:'t2',label:'Maternity leave by country',text:'What is the maternity leave policy? How does it differ between UAE, Malaysia, and Malta?'},
  {id:'remote',tag:'PHASE 2',cls:'t2',label:'Remote work policy',text:'What is the remote work policy? Can I work from another country temporarily?'},
  {id:'promo',tag:'PHASE 2',cls:'t2',label:'Promotion criteria',text:'When am I eligible for a promotion? What are the criteria and process?'},
  {id:'emp',tag:'PHASE 2',cls:'t2',label:'Employee profile: E103',text:'Get me the full profile and compliance status for employee E103'},
  {id:'req',tag:'PHASE 2',cls:'t2',label:'Submit address change',text:'I need to update my address. Employee E101. New address: 42 Marina Walk, Dubai Marina, Dubai, UAE'},
 ],
};

function renderP(phase){
 document.querySelectorAll('.pt').forEach(t=>t.classList.toggle('on',t.dataset.p===phase));
 const list=P[phase]||P.all;
 document.getElementById('prompts').innerHTML=list.map(p=>`<button class="pb" onclick="fire('${p.id}')"><span class="tag ${p.cls}">${p.tag}</span>${p.label}</button>`).join('');
}
document.querySelectorAll('.pt').forEach(t=>t.onclick=()=>renderP(t.dataset.p));
renderP('all');

function findP(id){for(const l of Object.values(P)){const f=l.find(x=>x.id===id);if(f)return f;}return null;}

function fire(id){const p=findP(id);if(p){document.getElementById('inp').value=p.text;send();}}

// ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ
function addMsg(role,text){
 const w=document.getElementById('wel');if(w)w.remove();
 const d=document.createElement('div');d.className=`m ${role==='user'?'u':'a'}`;
 d.innerHTML=`<div class="m-from">${role==='user'?'You':'ü§ñ HR Agent (Gemini 2.5 Flash)'}</div><div class="m-bub">${role==='user'?esc(text):fmt(text)}</div>`;
 document.getElementById('msgs').appendChild(d);
 scroll();
}

function addThink(){
 const d=document.createElement('div');d.className='thk';d.id='thk';
 d.innerHTML='ü§ñ Agent reasoning (calling tools, analyzing data) <span class="dd"><span>.</span><span>.</span><span>.</span></span>';
 document.getElementById('msgs').appendChild(d);scroll();
 // Start timer
 let s=0;
 document.getElementById('timer').style.display='block';
 timerInt=setInterval(()=>{s++;document.getElementById('tval').textContent=s+'s';},1000);
}
function rmThink(){
 const e=document.getElementById('thk');if(e)e.remove();
 document.getElementById('timer').style.display='none';
 if(timerInt){clearInterval(timerInt);timerInt=null;}
}

function scroll(){const m=document.getElementById('msgs');m.scrollTop=m.scrollHeight;}
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

// ‚îÄ‚îÄ FORMAT AGENT RESPONSE (Markdown-ish) ‚îÄ‚îÄ
function fmt(raw){
 let t=raw;
 // Escape HTML but preserve markdown
 t=t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
 // Headers
 t=t.replace(/^### (.+)$/gm,'<h3>$1</h3>');
 t=t.replace(/^## (.+)$/gm,'<h2>$1</h2>');
 t=t.replace(/^# (.+)$/gm,'<h1>$1</h1>');
 // Bold
 t=t.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
 // Italic
 t=t.replace(/\*(.+?)\*/g,'<em>$1</em>');
 // Inline code
 t=t.replace(/`(.+?)`/g,'<code>$1</code>');
 // Horizontal rules
 t=t.replace(/^---+$/gm,'<hr>');
 // Lists - both * and -
 t=t.replace(/^[\*\-] (.+)$/gm,'<li>$1</li>');
 // Numbered lists
 t=t.replace(/^\d+\. (.+)$/gm,'<li>$1</li>');
 // Wrap consecutive <li> in <ul>
 t=t.replace(/((?:<li>.*<\/li>\n?)+)/g,'<ul>$1</ul>');
 // Simple table support (| col | col |)
 t=t.replace(/^\|(.+)\|$/gm, function(match, inner){
  const cells=inner.split('|').map(c=>c.trim());
  if(cells.every(c=>/^[-:]+$/.test(c)))return ''; // separator row
  const tag=cells.length>0?'td':'td';
  return '<tr>'+cells.map(c=>`<${tag}>${c}</${tag}>`).join('')+'</tr>';
 });
 t=t.replace(/((?:<tr>.*<\/tr>\n?)+)/g,'<table>$1</table>');
 return t;
}

// ‚îÄ‚îÄ SEND ‚îÄ‚îÄ
async function send(){
 const el=document.getElementById('inp');
 const text=el.value.trim();
 if(!text||busy)return;
 el.value='';el.style.height='42px';
 addMsg('user',text);
 busy=true;document.getElementById('sbtn').disabled=true;
 addThink();

 try{
  const r=await fetch(API+'/api/chat',{
   method:'POST',
   headers:{'Content-Type':'application/json'},
   body:JSON.stringify({message:text,user_id:UID}),
  });
  const d=await r.json();
  rmThink();
  addMsg('agent',d.response||'No response.');
 }catch(e){
  rmThink();
  addMsg('agent','‚ö†Ô∏è Cannot reach agent server.\n\nMake sure you ran:\n  python server.py\n\nfrom the deriv_hr/ directory.\n\nError: '+e.message);
 }
 busy=false;document.getElementById('sbtn').disabled=false;
 el.focus();
}

// ‚îÄ‚îÄ RESET ‚îÄ‚îÄ
async function reset(){
 try{await fetch(API+'/api/reset',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user_id:UID})});}catch(e){}
 document.getElementById('msgs').innerHTML=`
  <div class="wel" id="wel">
   <h2>Session reset ‚Äî ready for <em>next demo</em></h2>
   <p>Click a card to start a fresh conversation with the agent.</p>
   <div class="wel-grid">
    <div class="wel-card" onclick="fire('scan')"><div class="wic">üõ°</div><h3>Compliance Scan</h3><p>Autonomous scan of all employees</p></div>
    <div class="wel-card" onclick="fire('onboard')"><div class="wic">üìÑ</div><h3>Generate Onboarding</h3><p>Full document package in one command</p></div>
    <div class="wel-card" onclick="fire('leave')"><div class="wic">üí¨</div><h3>Ask Policy Question</h3><p>Instant answer from HR knowledge base</p></div>
   </div>
  </div>`;
}

// ‚îÄ‚îÄ AUTO-RESIZE ‚îÄ‚îÄ
document.getElementById('inp').addEventListener('input',function(){this.style.height='42px';this.style.height=Math.min(this.scrollHeight,140)+'px';});

// ‚îÄ‚îÄ HEALTH CHECK ‚îÄ‚îÄ
async function hc(){
 try{
  const r=await fetch(API+'/api/health');
  const d=await r.json();
  const ok=d.agent;
  document.getElementById('stxt').textContent=ok?'Agent Live ¬∑ 12 tools ¬∑ Gemini 2.5 Flash':'‚ö†Ô∏è Agent Offline';
  document.getElementById('dot').style.background=ok?'var(--gn)':'var(--red)';
 }catch{
  document.getElementById('stxt').textContent='Server Offline';
  document.getElementById('dot').style.background='var(--red)';
 }
}
hc();setInterval(hc,10000);
</script>
</body>
</html>
